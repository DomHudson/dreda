<!DOCTYPE html>
<html>
  <head>
    <title>dreda</title>

    <!-- deps -->
    <script src="./lib/three.min.js"></script>
    <script src="./lib/OrbitControls.js"></script>
    <script src="./lib/THREEx/THREEx.FullScreen.js"></script>
    <script src="./lib/THREEx/THREEx.WindowResize.js"></script>
    <script src="./lib/rAF.js"></script>
    <script src="./lib/jquery-2.1.3.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore.js"></script>
  </head>
<body>
<script>
  
/*
 * DREDA
 * 
 * Lots of help from stemkoski.github.io
 * 
 */

// globals
var scene, camera, renderer, controls, stats;

// custom globals
var data;
var x_values = new Array();
var y_values = new Array();
var z_values = new Array();
var cid_values = new Array();

// colors (rainbow husl, 30 shades)
colors = 
['#f68870',
 '#f76773',
 '#f33279',
 '#db3188',
 '#ca3191',
 '#bb3197',
 '#ad319c',
 '#9e31a1',
 '#8e31a5',
 '#7731aa',
 '#4f31b0',
 '#325cb1',
 '#337ab0',
 '#348cae',
 '#3499ad',
 '#35a4ac',
 '#36aeab',
 '#37b9aa',
 '#38c5a8',
 '#39d4a6',
 '#3beca3',
 '#6ef49a',
 '#94f491',
 '#b1f486',
 '#ccf479',
 '#e7f466',
 '#f4e35f',
 '#f5cc65',
 '#f5b769',
 '#f6a26d'];

// analytics area size
var edge = 500;

// calls
init();
animate();
loadData();
plotData();

////////////////
// functions //
////////////// 

function init()
{

  // create a new scene
  scene = new THREE.Scene();
  
  // add a camera
  var SCREEN_WIDTH = window.innerWidth, SCREEN_HEIGHT = window.inner_height;
  var VIEW_ANGLE = 45;
  var ASPECT = SCREEN_WIDTH / SCREEN_HEIGHT;
  var NEAR = 0.1;
  var FAR = 20000;
  camera = new THREE.PerspectiveCamera(VIEW_ANGLE, ASPECT, NEAR, FAR);
  scene.add(camera);
  camera.position.set(0,150,400);
  camera.lookAt(scene.position);

  // create the renderer
  renderer = new THREE.WebGLRenderer({antialias: true, alpha:true});
  renderer.setSize(SCREEN_WIDTH, SCREEN_HEIGHT);
  renderer.setClearColor( 0xffffff, 1);
  
  // attach to container
  document.body.appendChild(renderer.domElement);
 
  // events
  THREEx.WindowResize(renderer, camera);
  //THREEx.FullScreen.bindKey({ charCode: 'm'.charCodeAt(0) });
  // I don't think we need this ?

  // controls
  controls = new THREE.OrbitControls(camera, renderer.domElement);

  // stats
  // TODO: Add Stats

  // add lights
  var light = new THREE.DirectionalLight(0xffffff, 1.5);
  light.position.set(100,300,100);
  scene.add(light);

  // add grid
  var gridxz = new THREE.GridHelper(edge,edge*.1);          //size, step
  gridxz.setColors(
    new THREE.Color(0x006600),                              //chill green
    new THREE.Color(0x006600)
  );
  gridxz.position.set(0,0,0);
  scene.add(gridxz);

  // add y axis
  var lineGeometry = new THREE.Geometry();
  var vertArray = lineGeometry.vertices;
  vertArray.push( new THREE.Vector3(0, -edge, 0), new THREE.Vector3(0, edge, 0) );
  lineGeometry.computeLineDistances();
  var lineMaterial = new THREE.LineDashedMaterial( { color: 0x0000cc, dashSize: 1, gapSize: 3 } );
  var line = new THREE.Line( lineGeometry, lineMaterial );
  scene.add(line);
  
  // get the data
  $.getJSON('./data/sample_data.json', function(json){
    data = json 
    }
  )
}


function animate(){
  requestAnimationFrame(animate);
  render();
  update();
}

function update(){
  controls.update();
  // stats.update();
}

function render(){
  renderer.render(scene,camera);
}

function loadData(){
  // Wow I love Underscore.js
  for (var i=0; i < _.size(_.values(data)[0]); i++){
    x_values.push(data.x[i]);
    y_values.push(data.y[i]);
    z_values.push(data.z[i]); 
    cid_values.push(data.cid[i]);
  }
}

function addSphere(x,y,z,c){
  var geometry = new THREE.SphereGeometry(edge/100,32,32);
  var material= new THREE.MeshBasicMaterial({color: c});
  var sphere = new THREE.Mesh(geometry, material);
  sphere.position.set(x,y,z) 
  scene.add(sphere);
}

function plotData(data){
  loadData();
  // TODO Trigger Loading Animation
  for (var i=0; i < x_values.length; i++){
    addSphere(x_values[i], y_values[i], z_values[i], colors[cid_values[i]] )
  }
}

</script>
</body>
</html>
